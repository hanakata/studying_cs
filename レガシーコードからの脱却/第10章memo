第10章 プラクティス6

テストと呼ばれるもの
・受け入れテスト＝顧客テスト
→ストーリーのふるまいを明確にする
受け入れテストはエッジケースの箇所や特定のシナリオに対する例外を理解するのに役立つ
また受け入れ基準を明確に定義することで受け入れテストがどうなったら終わるかが確実になる。
受け入れテストには自動化するツールで使われるGherkinと呼ばれる言語がある。

・ユニットテスト＝開発者によるテスト
ストーリーよりも小さいユニットをテストするためのもの
コードの開発を進めるためにユニットテストを作る
ユニットテストは内部ドキュメントとしても機能させることによって多くの時間が節約できる。

・それ以外のテスト＝QAテスト
上記以外はQAプロセスの一部。
結合テストは実際の依存関係を使用してコンポーネント間の相互作用をテストする。
そのためテストが壊れやすく遅いものとなる。
したがって依存関係は切り離してユニットレベルでできる限りのテストを行うほうがよい。
→スピードアップにつながる
そしてテストは自動化するべき。
ただ人の介入も必要なのでそういったテストはそういうテストで行うべき。

QA
QAテストの形態
・コンポーネントテスト
→ユニットがどのように連携するか
・機能テスト
→エンドツーエンドのふるまいを完全なものにする
・シナリオテスト
→ユーザがシステムと対話
・パフォーマンステスト
→ユーザ単体ではなく大量になったときどうなるか
・セキュリティテスト
→脆弱性調査

テスト駆動開発はQAの代わりではない
テストファースト開発をしていれば自動回帰テストを用意する手助けにはなる。
ただしあとからテストを追加することにはなる可能性が高い。
ふるまいを検証するのではなくふるまいを表す方法としてテストファースト開発を行うと
どんなテストが必要かより明確に理解できる。

ユニットテストは万能ではない
ユニットテストは素晴らしいスタート地点ではある。
ただしテストファーストにしておかなければ意味がない。
テストファーストにしておけば単なる自動化されたユニットテスト以上のものを得られるし
これによって良い設計がなされたシステムを作る手助けになる。

良いテストを書く
良いテストを書くためにはスキルを習得しなければならない
→ほとんどの開発者が良いテストを書けていない
テストファースト＝小さな機能テストを書いてからその機能を実装する
→Go言語でやるやつ
コードを書いてからテストを書くのでも得られることはある。→自動化された回帰テストを好きな時に実行できる
ただテストを実行するためにコードをクリーンアップする必要が出てくることがほとんど
→最初にテストを書いておいた方がよい。

テスト駆動開発はQAの代わりではない
コードを書く前にユニットテストを書く
→これは一体何か？→仮説ととらえるのはどうか。
そうとらえるとテストは
・仮説であり、ふるまいの仕様
・回帰テストが常に用意されていて実行され、コードが期待したように機能することを検証すること
ある意味ではテストはセンサー。

ふるまいの集合体
ユニットはコードではなくふるまいの単位である。
コードは常に観察可能なふるまいをするべき。
なのでふるまいが変わらないのであればユニットテストは書く必要がない。

テスト駆動開発はすばやいフィードバックをもたらす
ソフトウェアを開発する一番安価な方法は最初からバグが出ないようにすること
次に安価なのは同じ人が発見したらすぐに修正すること
テスト駆動開発は素早いフィードバックをもたらしてくれる。

テスト駆動開発はリファクタリングをサポートする
リファクタリング＝ソフトウェアの外部のふるまいを保ったまま内部の構造を改善していくようにソフトウェアシステムを変更するプロセス
→リファクタリングという書籍に記載がある。
アジャイルソフトウェア開発では全ての要件を事前に把握しようとせず考えながら設計を練り上げることが許されている
→すべてを最初から理解しようとするより、反復的にソフトウェアを作るほうが効率的。
コードがテスト可能＝リファクタリングが安全にできる。

テスト可能なコードを書く
テストファーストであることが重要ではなく、テスト可能なコードを書くかどうか。
テスト駆動開発はプロセスを単純化し困難な問題に取り組みやすくしてくれる。
テスト駆動開発は難易度を自身でコントロールすることができる
→問題を細分化できるため、哀れなほど簡単なものにまで細分化してテストすることは可能。

テスト駆動開発は失敗することがある
テスト駆動開発を続けると倒産するという状況であればやめたほうがいい。
失敗したケースとして、テストが冗長的になっていることがある。
テストもコードなのでCLEANを保つこと。
ユニットテストはユニットのふるまいをテストすることだと理解すること。

テスト駆動開発をチームに広める
テスト駆動開発の正しいやり方を身に着ける方法は存在しない。
まずは良い共通理解を形成すること。

テストに感染する
最初にテストを書かなければならないのは苦痛
→よくわかる
開発者は作るのは何か？から始めるべき。
作るものは何か？からどうやって作るかに焦点を合わせる。
→これが苦痛にならなくなったらテストに感染し始めた証拠

優れた受け入れテストのための7つの戦略
・作っているものが何に役立つのか明確にする
受け入れテストを書くことで何を作っているのか、それがシステムでどうなるのかを明らかにする必要がある。
・誰が何のために何をしたいのかを知る
ユーザが何を望んでいるかを知り、開発者はそれが誰のためでありなぜそれをしたいのかを知る必要がある。
・受け入れ基準を自動化する
・エッジケース、例外、代替パスを表す
・例示をつかって詳細を具体化し矛盾を一掃する
・受け入れ基準とふるまいの分離
・各テストを一意にする

優れたユニットテストのための7つの戦略
・呼び出し側の視点に立つ
・テストをつかってふるまいを表す
・新しい違いを生み出すテストだけを書く
・失敗したテストにパスするためのコードのみを書く
・テストを使ってふるまいを作る
・コードをリファクタリングする
・テストをリファクタリングする

まとめ
・テストファースト開発の方法とそれをする理由
・あまりにも多くのテストを書いたり実装依存のテストを書いたりするとテストファースト開発は簡単に失敗する
・テストはコードのリファクタリングをサポートする必要がありふるまいを表すテストだけを記述する
・テストファースト開発はQAに役立つがQAに代わるものではない
・テストファースト開発は失敗するテストを作成し合格する十分なコードで機能を作る。